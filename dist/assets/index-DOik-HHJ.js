(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class x{a;b;c;d;e;f;g;h;i;static zero(){return new x(0,0,0,0,0,0,0,0,0)}static identity(){return new x(1,0,0,0,1,0,0,0,1)}static fromArray(t){return new x(...t)}static rotateX(t){const n=Math.cos(t),r=Math.sin(t);return new x(1,0,0,0,n,-r,0,r,n)}static rotateY(t){const n=Math.cos(t),r=Math.sin(t);return new x(n,0,r,0,1,0,-r,0,n)}static rotateZ(t){const n=Math.cos(t),r=Math.sin(t);return new x(n,-r,0,r,n,0,0,0,1)}static scale(t,n,r){return n??=t,r??=n,new x(t,0,0,0,n,0,0,0,r)}constructor(t,n,r,s,i,a,o,c,u){this.a=t,this.b=n,this.c=r,this.d=s,this.e=i,this.f=a,this.g=o,this.h=c,this.i=u}get array(){return[this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i]}get transposeArray(){return[this.a,this.d,this.g,this.b,this.e,this.h,this.c,this.f,this.i]}get determinant(){return this.a*(this.e*this.i-this.f*this.h)-this.b*(this.d*this.i-this.f*this.g)+this.c*(this.d*this.h-this.e*this.g)}get string(){return this.toString()}get clone(){return new x(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i)}toString(){return`(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f}, ${this.g}, ${this.h}, ${this.i})`}toFixedString(t=2){return`(${this.a.toFixed(t)}, ${this.b.toFixed(t)}, ${this.c.toFixed(t)}, ${this.d.toFixed(t)}, ${this.e.toFixed(t)}, ${this.f.toFixed(t)}, ${this.g.toFixed(t)}, ${this.h.toFixed(t)}, ${this.i.toFixed(t)})`}add(t){return this.a+=t.a,this.b+=t.b,this.c+=t.c,this.d+=t.d,this.e+=t.e,this.f+=t.f,this.g+=t.g,this.h+=t.h,this.i+=t.i,this}sub(t){return this.a-=t.a,this.b-=t.b,this.c-=t.c,this.d-=t.d,this.e-=t.e,this.f-=t.f,this.g-=t.g,this.h-=t.h,this.i-=t.i,this}mult(t){const n=this.a*t.a+this.b*t.d+this.c*t.g,r=this.a*t.b+this.b*t.e+this.c*t.h,s=this.a*t.c+this.b*t.f+this.c*t.i,i=this.d*t.a+this.e*t.d+this.f*t.g,a=this.d*t.b+this.e*t.e+this.f*t.h,o=this.d*t.c+this.e*t.f+this.f*t.i,c=this.g*t.a+this.h*t.d+this.i*t.g,u=this.g*t.b+this.h*t.e+this.i*t.h,f=this.g*t.c+this.h*t.f+this.i*t.i;return this.a=n,this.b=r,this.c=s,this.d=i,this.e=a,this.f=o,this.g=c,this.h=u,this.i=f,this}scale(t){return this.a*=t,this.b*=t,this.c*=t,this.d*=t,this.e*=t,this.f*=t,this.g*=t,this.h*=t,this.i*=t,this}inverseScale(t){const n=1/t;return this.a*=n,this.b*=n,this.c*=n,this.d*=n,this.e*=n,this.f*=n,this.g*=n,this.h*=n,this.i*=n,this}inverse(){const t=this.determinant;if(t==0)return null;const n=1/t,r=(this.e*this.i-this.f*this.h)*n,s=(this.c*this.h-this.b*this.i)*n,i=(this.b*this.f-this.c*this.e)*n,a=(this.f*this.g-this.d*this.i)*n,o=(this.a*this.i-this.c*this.g)*n,c=(this.c*this.d-this.a*this.f)*n,u=(this.d*this.h-this.e*this.g)*n,f=(this.b*this.g-this.a*this.h)*n,h=(this.a*this.e-this.b*this.d)*n;return this.a=r,this.b=s,this.c=i,this.d=a,this.e=o,this.f=c,this.g=u,this.h=f,this.i=h,this}transpose(){const t=this.b;this.b=this.d,this.d=t;const n=this.c;this.c=this.g,this.g=n;const r=this.f;return this.f=this.h,this.h=r,this}}class d{x;y;z;static zero(){return new d(0,0,0)}static one(){return new d(1,1,1)}static up(){return new d(0,1,0)}static down(){return new d(0,-1,0)}static right(){return new d(1,0,0)}static left(){return new d(-1,0,0)}static backward(){return new d(0,0,1)}static forward(){return new d(0,0,-1)}static fromArray([t,n,r]){return new d(t,n,r)}static fromObject({x:t,y:n,z:r}){return new d(t,n,r)}constructor(t,n=t,r=n){this.x=t,this.y=n,this.z=r}get length(){return Math.hypot(this.x,this.y,this.z)}get lengthSq(){return this.x**2+this.y**2+this.z**2}get array(){return[this.x,this.y,this.z]}get object(){return{x:this.x,y:this.y,z:this.z}}get string(){return this.toString()}get clone(){return new d(this.x,this.y,this.z)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}toFixedString(t=2){return`(${this.x.toFixed(t)}, ${this.y.toFixed(t)}, ${this.z.toFixed(t)})`}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mult(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}matrixMult(t){const n=this.x*t.a+this.y*t.b+this.z*t.c,r=this.x*t.d+this.y*t.e+this.z*t.f,s=this.x*t.g+this.y*t.h+this.z*t.i;return this.x=n,this.y=r,this.z=s,this}div(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}inverseScale(t){const n=1/t;return this.x*=n,this.y*=n,this.z*=n,this}mix(t,n=.5){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}norm(t=1){const n=this.length;if(this.length===0)return this;const r=t/n;return this.x*=r,this.y*=r,this.z*=r,this}limit(t=1){const n=Math.min(this.length,t);return this.norm(n),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const n=this.x;this.x=this.y*t.z-this.z*t.y;const r=this.y;return this.y=this.z*t.x-n*t.z,this.z=n*t.y-r*t.x,this}dist(t){return Math.hypot(t.x-this.x,t.y-this.y,t.z-this.z)}distSq(t){return(t.x-this.x)**2+(t.y-this.y)**2+(t.z-this.z)**2}equalTo(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}equalToSoft(t,n=.01){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=n}}const dt={uni:new Set,var:new Set};function ce(e){let t=dt[e],n;do n=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);while(t.has(n));return`_${e}${n}_`}function ue(e){dt[e].clear()}function fe(){ue("var")}function w(e){return e.filter(t=>t instanceof he)}function S(e){return typeof e=="number"?new At(mt(e)):e}function g(e){if(e instanceof d){const t=e.array.map(mt).join(", ");return new At(`vec3(${t})`)}else return e}function mt(e){let t=String(e);return t.includes(".")||(t=t.concat(".0")),t}class yt{}class pt extends yt{identifier;constructor(t){super(),this.identifier=ce(t)}toString(){return this.identifier}}class At extends yt{value;constructor(t){super(),this.value=t}toString(){return this.value}}class he extends pt{value;constructor(t){super("uni"),this.value=t}setValue(t){this.value=t}}class m extends pt{constructor(){super("var")}}let bt,St;async function le(){const e=fetch("shader.vert").then(n=>n.text()),t=fetch("shader.frag").then(n=>n.text());[bt,St]=await Promise.all([e,t])}class Et{getProgram(){const t=new m,{body:n,result:r}=this.getCode(t),{body:s,result:i}=this.getMaterialCode(t),a=this.getUniforms(),o=a.map(h=>h.getDeclaration()).join(`
`),c=`float sdf(vec3 ${t}) {${n}
    return ${r};
}`,u=`Material matf(vec3 ${t}) {${s}
    return ${i};
}`,f=St.replace("#WORLD_UNIFORMS",o).replace("#SDF_FUNCTION",c).replace("#MATERIAL_FUNCTION",u);return fe(),[bt,f,a]}}class _ extends Et{material;constructor(t){super(),this.material=t}getCode(t){return this.getPrimitiveCode(t)}getMaterialCode(){return this.material.getCode()}getUniforms(){return[...this.getSelfUniforms(),...this.material.getUniforms()]}}class V extends Et{children;constructor(...t){super(),this.children=t}getCode(t){const{body:n,result:r}=this.getPositionCode(t),s=[],i=[];for(const c of this.children){const{body:u,result:f}=c.getCode(r);s.push(u),i.push(f)}const{body:a,result:o}=this.getDistanceCode(...i);return{body:`${n}${s.join("")}${a}`,result:o}}getMaterialCode(t){const{body:n,result:r}=this.getPositionCode(t),s=[],i=[];for(const u of this.children){const{body:f,result:h}=u.getCode(r);s.push(f),i.push(h)}const{body:a,result:o}=this.getSelfMaterialCode(t,...i);return{body:`${n}${s.join("")}${a}`,result:o}}getUniforms(){const t=[];for(const n of this.children)t.push(...n.getUniforms());return t.push(...this.getSelfUniforms()),t}getPositionCode(t){return{body:"",result:g(t)}}getDistanceCode(...t){return{body:"",result:S(t[0])}}}class G extends V{getMaterialCode(t){const{body:n,result:r}=this.getPositionCode(t),{body:s,result:i}=this.children[0].getMaterialCode(r);return{body:`${n}${s}`,result:i}}getSelfMaterialCode(){throw Error("Can't run getSelfMaterialCode() on FirstMaterialCompoundField")}}await le();class I{diffuse;specular;static zero(){return new I(d.zero(),d.zero())}constructor(t,n){this.diffuse=g(t),this.specular=g(n)}getCode(){const t=new m;return{body:`
    Material ${t} = Material(${this.diffuse}, ${this.specular});`,result:t}}getUniforms(){return w([this.diffuse,this.specular])}}function de(e,t,n){const r=S(n),s=new m,{body:i,result:a}=e,{body:o,result:c}=t;return{body:`${i}${o}
    Material ${s} = mix(${a}, ${c}, ${r});
    `,result:s}}class me extends V{constructor(...t){super(...t)}getSelfUniforms(){return[]}getDistanceCode(...t){const n=t.map(S),r=new m,s=n.map(String).join(", ");return{body:`
    float ${r} = min(${s});`,result:r}}getSelfMaterialCode(t,...n){const r=n.map(S),s=new m,i=new m,a=r.map(String).join(", ");let o=`
    float ${s} = min(${a});
    Material ${i};`;for(let c=0;c<r.length;c++){const{body:u,result:f}=this.children[c].getMaterialCode(t),h=c?" else if":`
if`;o=o.concat(`    ${h} (${s} == ${r[c]}) {${u}
    ${i} = ${f};
    }`)}return{body:o,result:i}}}class L extends V{strength;constructor(t,n,r){super(n,r),this.strength=S(t)}getSelfUniforms(){return w([this.strength])}getDistanceCode(...t){const[n,r]=t.map(S),s=new m,i=new m;return{body:`
    float ${s} = clamp(0.5 + 0.5 * (${r} - ${n}) / ${this.strength}, 0.0, 1.0);
    float ${i} = mix(${r}, ${n}, ${s}) - ${this.strength} * ${s} * (1.0 - ${s});`,result:i}}getSelfMaterialCode(t,...n){const[r,s]=n.map(S),[i,a]=this.children.map(h=>h.getMaterialCode(t)),o=new m,{body:c,result:u}=de(a,i,o);return{body:`
    float ${o} = clamp(0.5 + 0.5 * (${s} - ${r}) / ${this.strength}, 0.0, 1.0);${c}`,result:u}}}class ye extends _{constructor(){super(I.zero())}getSelfUniforms(){return[]}getPrimitiveCode(t){const n=new m;return{body:`
    float ${n} = INFINITY;`,result:n}}}class st extends _{size;constructor(t,n){super(n),this.size=g(t)}getSelfUniforms(){return w([this.size])}getPrimitiveCode(t){const n=g(t),r=new m,s=new m;return{body:`
    vec3 ${r} = abs(${n}) - ${this.size};
    float ${s} = length(max(${r}, 0.0)) + min(max(${r}.x, max(${r}.y, ${r}.z)), 0.0);`,result:s}}}class it extends _{major;minor;constructor(t,n,r){super(r),this.major=S(t),this.minor=S(n)}getSelfUniforms(){return w([this.major,this.minor])}getPrimitiveCode(t){const n=g(t),r=new m,s=new m;return{body:`
    vec2 ${r} = vec2(length(${n}.xz) - ${this.major}, ${n}.y);
    float ${s} = length(${r}) - ${this.minor};`,result:s}}}class pe extends _{height;radius;constructor(t,n,r){super(r),this.height=S(t),this.radius=S(n)}getSelfUniforms(){return w([this.height,this.radius])}getPrimitiveCode(t){const n=g(t),r=new m,s=new m;return{body:`
    vec2 ${r} = abs(vec2(length(${n}.xz), ${n}.y)) - vec2(${this.radius}, ${this.height});
    float ${s} = min(max(${r}.x, ${r}.y), 0.0) + length(max(${r}, 0.0)); `,result:s}}}class v extends G{translation;constructor(t,n){super(n),this.translation=g(t)}getSelfUniforms(){return w([this.translation])}getPositionCode(t){const n=g(t),r=new m;return{body:`
    vec3 ${r} = ${n} - ${this.translation};`,result:r}}}class ot extends G{strength;constructor(t,n){super(n),this.strength=S(t)}getSelfUniforms(){return w([this.strength])}getDistanceCode(t){const n=S(t),r=new m;return{body:`
    float ${r} = ${n} - ${this.strength};`,result:r}}}class Ae extends G{size;constructor(t,n){super(n),this.size=g(t)}getSelfUniforms(){return w([this.size])}getPositionCode(t){const n=g(t),r=new m,s=new m,i=new m;return{body:`
    vec3 ${r} = round(${n} / ${this.size});
    vec3 ${s} = ${n} - ${this.size} * ${r};
    vec3 ${i} = vec3(((int(${r}.x) & 1) == 0) ? ${s}.x : -${s}.x,
                                       ((int(${r}.y) & 1) == 0) ? ${s}.y : -${s}.y,
                                       ((int(${r}.z) & 1) == 0) ? ${s}.z : -${s}.z);`,result:i}}}/* @license twgl.js 5.5.4 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */const H=5120,F=5121,K=5122,W=5123,Y=5124,j=5125,X=5126,be=32819,Se=32820,Ee=33635,Te=5131,xe=33640,ge=35899,we=35902,$e=36269,Ce=34042,Tt={};{const e=Tt;e[H]=Int8Array,e[F]=Uint8Array,e[K]=Int16Array,e[W]=Uint16Array,e[Y]=Int32Array,e[j]=Uint32Array,e[X]=Float32Array,e[be]=Uint16Array,e[Se]=Uint16Array,e[Ee]=Uint16Array,e[Te]=Uint16Array,e[xe]=Uint32Array,e[ge]=Uint32Array,e[we]=Uint32Array,e[$e]=Uint32Array,e[Ce]=Uint32Array}function xt(e){if(e instanceof Int8Array)return H;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return F;if(e instanceof Int16Array)return K;if(e instanceof Uint16Array)return W;if(e instanceof Int32Array)return Y;if(e instanceof Uint32Array)return j;if(e instanceof Float32Array)return X;throw new Error("unsupported typed array type")}function gt(e){if(e===Int8Array)return H;if(e===Uint8Array||e===Uint8ClampedArray)return F;if(e===Int16Array)return K;if(e===Uint16Array)return W;if(e===Int32Array)return Y;if(e===Uint32Array)return j;if(e===Float32Array)return X;throw new Error("unsupported typed array type")}function ve(e){const t=Tt[e];if(!t)throw new Error("unknown gl type");return t}const O=typeof SharedArrayBuffer<"u"?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function Ie(...e){console.error(...e)}const at=new Map;function wt(e,t){if(!e||typeof e!="object")return!1;let n=at.get(t);n||(n=new WeakMap,at.set(t,n));let r=n.get(e);if(r===void 0){const s=Object.prototype.toString.call(e);r=s.substring(8,s.length-1)===t,n.set(e,r)}return r}function Fe(e,t){return typeof WebGLBuffer<"u"&&wt(t,"WebGLBuffer")}function $t(e,t){return typeof WebGLTexture<"u"&&wt(t,"WebGLTexture")}const Ct=35044,C=34962,ze=34963,_e=34660,Re=5120,Be=5121,Ue=5122,De=5123,Ne=5124,Pe=5125,vt=5126,It={attribPrefix:""};function Me(e,t,n,r,s){e.bindBuffer(t,n),e.bufferData(t,r,s||Ct)}function Ft(e,t,n,r){if(Fe(e,t))return t;n=n||C;const s=e.createBuffer();return Me(e,n,s,t,r),s}function zt(e){return e==="indices"}function Le(e){return e===Int8Array||e===Uint8Array}function ke(e){return e.length?e:e.data}const Oe=/coord|texture/i,Ve=/color|colour/i;function Ge(e,t){let n;if(Oe.test(e)?n=2:Ve.test(e)?n=4:n=3,t%n>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${n} but ${t} values is not evenly divisible by ${n}. You should specify it.`);return n}function He(e,t,n){return e.numComponents||e.size||Ge(t,n||ke(e).length)}function _t(e,t){if(O(e))return e;if(O(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type?q(e.type):void 0;return n||(zt(t)?n=Uint16Array:n=Float32Array),new n(e.data)}function Ke(e){return typeof e=="number"?e:e?gt(e):vt}function q(e){return typeof e=="number"?ve(e):e||Float32Array}function We(e,t){return{buffer:t.buffer,numValues:2*3*4,type:Ke(t.type),arrayType:q(t.type)}}function Ye(e,t){const n=t.data||t,r=q(t.type),s=n*r.BYTES_PER_ELEMENT,i=e.createBuffer();return e.bindBuffer(C,i),e.bufferData(C,s,t.drawType||Ct),{buffer:i,numValues:n,type:gt(r),arrayType:r}}function je(e,t,n){const r=_t(t,n);return{arrayType:r.constructor,buffer:Ft(e,r,void 0,t.drawType),type:xt(r),numValues:0}}function Xe(e,t){const n={};return Object.keys(t).forEach(function(r){if(!zt(r)){const s=t[r],i=s.attrib||s.name||s.attribName||It.attribPrefix+r;if(s.value){if(!Array.isArray(s.value)&&!O(s.value))throw new Error("array.value is not array or typedarray");n[i]={value:s.value}}else{let a;s.buffer&&s.buffer instanceof WebGLBuffer?a=We:typeof s=="number"||typeof s.data=="number"?a=Ye:a=je;const{buffer:o,type:c,numValues:u,arrayType:f}=a(e,s,r),h=s.normalize!==void 0?s.normalize:Le(f),b=He(s,r,u);n[i]={buffer:o,numComponents:b,type:c,normalize:h,stride:s.stride||0,offset:s.offset||0,divisor:s.divisor===void 0?void 0:s.divisor,drawType:s.drawType}}}}),e.bindBuffer(C,null),n}function qe(e,t){return t===Re||t===Be?1:t===Ue||t===De?2:t===Ne||t===Pe||t===vt?4:0}const k=["position","positions","a_position"];function Ze(e,t){let n,r;for(r=0;r<k.length&&(n=k[r],!(n in t||(n=It.attribPrefix+n,n in t)));++r);r===k.length&&(n=Object.keys(t)[0]);const s=t[n];if(!s.buffer)return 1;e.bindBuffer(C,s.buffer);const i=e.getBufferParameter(C,_e);e.bindBuffer(C,null);const a=qe(e,s.type),o=i/a,c=s.numComponents||s.size,u=o/c;if(u%1!==0)throw new Error(`numComponents ${c} not correct for length ${length}`);return u}function Je(e,t,n){const r=Xe(e,t),s=Object.assign({},n||{});s.attribs=Object.assign({},n?n.attribs:{},r);const i=t.indices;if(i){const a=_t(i,"indices");s.indices=Ft(e,a,ze),s.numElements=a.length,s.elementType=xt(a)}else s.numElements||(s.numElements=Ze(e,s.attribs));return s}function Z(e){return!!e.texStorage2D}const Qe=function(){const e={},t={};function n(r){const s=r.constructor.name;if(!e[s]){for(const i in r)if(typeof r[i]=="number"){const a=t[r[i]];t[r[i]]=a?`${a} | ${i}`:i}e[s]=!0}}return function(s,i){return n(s),t[i]||(typeof i=="number"?`0x${i.toString(16)}`:i)}}(),tn=6406,ct=6407,ut=6408,en=6409,nn=6410,rn=6402,sn=34041,on=33319,an=33320,cn=6403,un=36244,fn=36248,hn=36249,ln={};{const e=ln;e[tn]={numColorComponents:1},e[en]={numColorComponents:1},e[nn]={numColorComponents:2},e[ct]={numColorComponents:3},e[ut]={numColorComponents:4},e[cn]={numColorComponents:1},e[un]={numColorComponents:1},e[on]={numColorComponents:2},e[an]={numColorComponents:2},e[ct]={numColorComponents:3},e[fn]={numColorComponents:3},e[ut]={numColorComponents:4},e[hn]={numColorComponents:4},e[rn]={numColorComponents:1},e[sn]={numColorComponents:2}}const J=Ie;function Rt(e){return typeof document<"u"&&document.getElementById?document.getElementById(e):null}const z=33984,R=34962,dn=34963,mn=35713,yn=35714,pn=35632,An=35633,bn=35981,Bt=35718,Sn=35721,En=35971,Tn=35382,xn=35396,gn=35398,wn=35392,$n=35395,B=5126,Ut=35664,Dt=35665,Nt=35666,Q=5124,Pt=35667,Mt=35668,Lt=35669,kt=35670,Ot=35671,Vt=35672,Gt=35673,Ht=35674,Kt=35675,Wt=35676,Cn=35678,vn=35680,In=35679,Fn=35682,zn=35685,_n=35686,Rn=35687,Bn=35688,Un=35689,Dn=35690,Nn=36289,Pn=36292,Mn=36293,tt=5125,Yt=36294,jt=36295,Xt=36296,Ln=36298,kn=36299,On=36300,Vn=36303,Gn=36306,Hn=36307,Kn=36308,Wn=36311,U=3553,D=34067,et=32879,N=35866,l={};function qt(e,t){return l[t].bindPoint}function Yn(e,t){return function(n){e.uniform1f(t,n)}}function jn(e,t){return function(n){e.uniform1fv(t,n)}}function Xn(e,t){return function(n){e.uniform2fv(t,n)}}function qn(e,t){return function(n){e.uniform3fv(t,n)}}function Zn(e,t){return function(n){e.uniform4fv(t,n)}}function Zt(e,t){return function(n){e.uniform1i(t,n)}}function Jt(e,t){return function(n){e.uniform1iv(t,n)}}function Qt(e,t){return function(n){e.uniform2iv(t,n)}}function te(e,t){return function(n){e.uniform3iv(t,n)}}function ee(e,t){return function(n){e.uniform4iv(t,n)}}function Jn(e,t){return function(n){e.uniform1ui(t,n)}}function Qn(e,t){return function(n){e.uniform1uiv(t,n)}}function tr(e,t){return function(n){e.uniform2uiv(t,n)}}function er(e,t){return function(n){e.uniform3uiv(t,n)}}function nr(e,t){return function(n){e.uniform4uiv(t,n)}}function rr(e,t){return function(n){e.uniformMatrix2fv(t,!1,n)}}function sr(e,t){return function(n){e.uniformMatrix3fv(t,!1,n)}}function ir(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}}function or(e,t){return function(n){e.uniformMatrix2x3fv(t,!1,n)}}function ar(e,t){return function(n){e.uniformMatrix3x2fv(t,!1,n)}}function cr(e,t){return function(n){e.uniformMatrix2x4fv(t,!1,n)}}function ur(e,t){return function(n){e.uniformMatrix4x2fv(t,!1,n)}}function fr(e,t){return function(n){e.uniformMatrix3x4fv(t,!1,n)}}function hr(e,t){return function(n){e.uniformMatrix4x3fv(t,!1,n)}}function p(e,t,n,r){const s=qt(e,t);return Z(e)?function(i){let a,o;!i||$t(e,i)?(a=i,o=null):(a=i.texture,o=i.sampler),e.uniform1i(r,n),e.activeTexture(z+n),e.bindTexture(s,a),e.bindSampler(n,o)}:function(i){e.uniform1i(r,n),e.activeTexture(z+n),e.bindTexture(s,i)}}function A(e,t,n,r,s){const i=qt(e,t),a=new Int32Array(s);for(let o=0;o<s;++o)a[o]=n+o;return Z(e)?function(o){e.uniform1iv(r,a),o.forEach(function(c,u){e.activeTexture(z+a[u]);let f,h;!c||$t(e,c)?(f=c,h=null):(f=c.texture,h=c.sampler),e.bindSampler(n,h),e.bindTexture(i,f)})}:function(o){e.uniform1iv(r,a),o.forEach(function(c,u){e.activeTexture(z+a[u]),e.bindTexture(i,c)})}}l[B]={Type:Float32Array,size:4,setter:Yn,arraySetter:jn};l[Ut]={Type:Float32Array,size:8,setter:Xn,cols:2};l[Dt]={Type:Float32Array,size:12,setter:qn,cols:3};l[Nt]={Type:Float32Array,size:16,setter:Zn,cols:4};l[Q]={Type:Int32Array,size:4,setter:Zt,arraySetter:Jt};l[Pt]={Type:Int32Array,size:8,setter:Qt,cols:2};l[Mt]={Type:Int32Array,size:12,setter:te,cols:3};l[Lt]={Type:Int32Array,size:16,setter:ee,cols:4};l[tt]={Type:Uint32Array,size:4,setter:Jn,arraySetter:Qn};l[Yt]={Type:Uint32Array,size:8,setter:tr,cols:2};l[jt]={Type:Uint32Array,size:12,setter:er,cols:3};l[Xt]={Type:Uint32Array,size:16,setter:nr,cols:4};l[kt]={Type:Uint32Array,size:4,setter:Zt,arraySetter:Jt};l[Ot]={Type:Uint32Array,size:8,setter:Qt,cols:2};l[Vt]={Type:Uint32Array,size:12,setter:te,cols:3};l[Gt]={Type:Uint32Array,size:16,setter:ee,cols:4};l[Ht]={Type:Float32Array,size:32,setter:rr,rows:2,cols:2};l[Kt]={Type:Float32Array,size:48,setter:sr,rows:3,cols:3};l[Wt]={Type:Float32Array,size:64,setter:ir,rows:4,cols:4};l[zn]={Type:Float32Array,size:32,setter:or,rows:2,cols:3};l[_n]={Type:Float32Array,size:32,setter:cr,rows:2,cols:4};l[Rn]={Type:Float32Array,size:48,setter:ar,rows:3,cols:2};l[Bn]={Type:Float32Array,size:48,setter:fr,rows:3,cols:4};l[Un]={Type:Float32Array,size:64,setter:ur,rows:4,cols:2};l[Dn]={Type:Float32Array,size:64,setter:hr,rows:4,cols:3};l[Cn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:U};l[vn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:D};l[In]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:et};l[Fn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:U};l[Nn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:N};l[Pn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:N};l[Mn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:D};l[Ln]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:U};l[kn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:et};l[On]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:D};l[Vn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:N};l[Gn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:U};l[Hn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:et};l[Kn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:D};l[Wn]={Type:null,size:0,setter:p,arraySetter:A,bindPoint:N};function P(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(R,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||B,n.normalize||!1,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function $(e,t){return function(n){if(n.value)if(e.disableVertexAttribArray(t),n.value.length===4)e.vertexAttrib4iv(t,n.value);else throw new Error("The length of an integer constant value must be 4!");else e.bindBuffer(R,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||Q,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function M(e,t){return function(n){if(n.value)if(e.disableVertexAttribArray(t),n.value.length===4)e.vertexAttrib4uiv(t,n.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else e.bindBuffer(R,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||tt,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function nt(e,t,n){const r=n.size,s=n.count;return function(i){e.bindBuffer(R,i.buffer);const a=i.size||i.numComponents||r,o=a/s,c=i.type||B,f=l[c].size*a,h=i.normalize||!1,b=i.offset||0,E=f/s;for(let T=0;T<s;++T)e.enableVertexAttribArray(t+T),e.vertexAttribPointer(t+T,o,c,h,f,b+E*T),e.vertexAttribDivisor&&e.vertexAttribDivisor(t+T,i.divisor||0)}}const y={};y[B]={size:4,setter:P};y[Ut]={size:8,setter:P};y[Dt]={size:12,setter:P};y[Nt]={size:16,setter:P};y[Q]={size:4,setter:$};y[Pt]={size:8,setter:$};y[Mt]={size:12,setter:$};y[Lt]={size:16,setter:$};y[tt]={size:4,setter:M};y[Yt]={size:8,setter:M};y[jt]={size:12,setter:M};y[Xt]={size:16,setter:M};y[kt]={size:4,setter:$};y[Ot]={size:8,setter:$};y[Vt]={size:12,setter:$};y[Gt]={size:16,setter:$};y[Ht]={size:4,setter:nt,count:2};y[Kt]={size:9,setter:nt,count:3};y[Wt]={size:16,setter:nt,count:4};const lr=/ERROR:\s*\d+:(\d+)/gi;function dr(e,t="",n=0){const r=[...t.matchAll(lr)],s=new Map(r.map((i,a)=>{const o=parseInt(i[1]),c=r[a+1],u=c?c.index:t.length,f=t.substring(i.index,u);return[o-1,f]}));return e.split(`
`).map((i,a)=>{const o=s.get(a);return`${a+1+n}: ${i}${o?`

^^^ ${o}`:""}`}).join(`
`)}const ft=/^[ \t]*\n/;function ne(e){let t=0;return ft.test(e)&&(t=1,e=e.replace(ft,"")),{lineOffset:t,shaderSource:e}}function mr(e,t){return e.errorCallback(t),e.callback&&setTimeout(()=>{e.callback(`${t}
${e.errors.join(`
`)}`)}),null}function yr(e,t,n,r){if(r=r||J,!e.getShaderParameter(n,mn)){const i=e.getShaderInfoLog(n),{lineOffset:a,shaderSource:o}=ne(e.getShaderSource(n)),c=`${dr(o,i,a)}
Error compiling ${Qe(e,t)}: ${i}`;return r(c),c}return""}function rt(e,t,n){let r,s,i;if(typeof t=="function"&&(n=t,t=void 0),typeof e=="function")n=e,e=void 0;else if(e&&!Array.isArray(e)){const u=e;n=u.errorCallback,e=u.attribLocations,r=u.transformFeedbackVaryings,s=u.transformFeedbackMode,i=u.callback}const a=n||J,o=[],c={errorCallback(u,...f){o.push(u),a(u,...f)},transformFeedbackVaryings:r,transformFeedbackMode:s,callback:i,errors:o};{let u={};Array.isArray(e)?e.forEach(function(f,h){u[f]=t?t[h]:h}):u=e||{},c.attribLocations=u}return c}const pr=["VERTEX_SHADER","FRAGMENT_SHADER"];function Ar(e,t){if(t.indexOf("frag")>=0)return pn;if(t.indexOf("vert")>=0)return An}function br(e,t,n){const r=e.getAttachedShaders(t);for(const s of r)n.has(s)&&e.deleteShader(s);e.deleteProgram(t)}const Sr=(e=0)=>new Promise(t=>setTimeout(t,e));function Er(e,t,n){const r=e.createProgram(),{attribLocations:s,transformFeedbackVaryings:i,transformFeedbackMode:a}=rt(n);for(let o=0;o<t.length;++o){let c=t[o];if(typeof c=="string"){const u=Rt(c),f=u?u.text:c;let h=e[pr[o]];u&&u.type&&(h=Ar(e,u.type)||h),c=e.createShader(h),e.shaderSource(c,ne(f).shaderSource),e.compileShader(c),e.attachShader(r,c)}}Object.entries(s).forEach(([o,c])=>e.bindAttribLocation(r,c,o));{let o=i;o&&(o.attribs&&(o=o.attribs),Array.isArray(o)||(o=Object.keys(o)),e.transformFeedbackVaryings(r,o,a||bn))}return e.linkProgram(r),r}function Tr(e,t,n,r,s){const i=rt(n,r,s),a=new Set(t),o=Er(e,t,i);function c(u,f){const h=gr(u,f,i.errorCallback);return h&&br(u,f,a),h}if(i.callback){xr(e,o).then(()=>{const u=c(e,o);i.callback(u,u?void 0:o)});return}return c(e,o)?void 0:o}async function xr(e,t){const n=e.getExtension("KHR_parallel_shader_compile"),r=n?(i,a)=>i.getProgramParameter(a,n.COMPLETION_STATUS_KHR):()=>!0;let s=0;do await Sr(s),s=1e3/60;while(!r(e,t))}function gr(e,t,n){if(n=n||J,!e.getProgramParameter(t,yn)){const s=e.getProgramInfoLog(t);n(`Error in program linking: ${s}`);const a=e.getAttachedShaders(t).map(o=>yr(e,e.getShaderParameter(o,e.SHADER_TYPE),o,n));return`${s}
${a.filter(o=>o).join(`
`)}`}}function wr(e,t,n,r,s){return Tr(e,t,n,r,s)}function re(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}const $r=/(\.|\[|]|\w+)/g,Cr=e=>e>="0"&&e<="9";function vr(e,t,n,r){const s=e.split($r).filter(o=>o!=="");let i=0,a="";for(;;){const o=s[i++];a+=o;const c=Cr(o[0]),u=c?parseInt(o):o;if(c&&(a+=s[i++]),i===s.length){n[u]=t;break}else{const h=s[i++],b=h==="[",E=n[u]||(b?[]:{});n[u]=E,n=E,r[a]=r[a]||function(T){return function(ae){se(T,ae)}}(E),a+=h}}}function Ir(e,t){let n=0;function r(o,c,u){const f=c.name.endsWith("[0]"),h=c.type,b=l[h];if(!b)throw new Error(`unknown type: 0x${h.toString(16)}`);let E;if(b.bindPoint){const T=n;n+=c.size,f?E=b.arraySetter(e,h,T,u,c.size):E=b.setter(e,h,T,u,c.size)}else b.arraySetter&&f?E=b.arraySetter(e,u):E=b.setter(e,u);return E.location=u,E}const s={},i={},a=e.getProgramParameter(t,Bt);for(let o=0;o<a;++o){const c=e.getActiveUniform(t,o);if(re(c))continue;let u=c.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));const f=e.getUniformLocation(t,c.name);if(f){const h=r(t,c,f);s[u]=h,vr(u,h,i,s)}}return s}function Fr(e,t){const n={},r=e.getProgramParameter(t,En);for(let s=0;s<r;++s){const i=e.getTransformFeedbackVarying(t,s);n[i.name]={index:s,type:i.type,size:i.size}}return n}function zr(e,t){const n=e.getProgramParameter(t,Bt),r=[],s=[];for(let o=0;o<n;++o){s.push(o),r.push({});const c=e.getActiveUniform(t,o);r[o].name=c.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(o){const c=o[0],u=o[1];e.getActiveUniforms(t,s,e[c]).forEach(function(f,h){r[h][u]=f})});const i={},a=e.getProgramParameter(t,Tn);for(let o=0;o<a;++o){const c=e.getActiveUniformBlockName(t,o),u={index:e.getUniformBlockIndex(t,c),usedByVertexShader:e.getActiveUniformBlockParameter(t,o,xn),usedByFragmentShader:e.getActiveUniformBlockParameter(t,o,gn),size:e.getActiveUniformBlockParameter(t,o,wn),uniformIndices:e.getActiveUniformBlockParameter(t,o,$n)};u.used=u.usedByVertexShader||u.usedByFragmentShader,i[c]=u}return{blockSpecs:i,uniformData:r}}function se(e,t){for(const n in t){const r=e[n];typeof r=="function"?r(t[n]):se(e[n],t[n])}}function ie(e,...t){const n=e.uniformSetters||e,r=t.length;for(let s=0;s<r;++s){const i=t[s];if(Array.isArray(i)){const a=i.length;for(let o=0;o<a;++o)ie(n,i[o])}else for(const a in i){const o=n[a];o&&o(i[a])}}}function _r(e,t){const n={},r=e.getProgramParameter(t,Sn);for(let s=0;s<r;++s){const i=e.getActiveAttrib(t,s);if(re(i))continue;const a=e.getAttribLocation(t,i.name),o=y[i.type],c=o.setter(e,a,o);c.location=a,n[i.name]=c}return n}function Rr(e,t){for(const n in t){const r=e[n];r&&r(t[n])}}function Br(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(Rr(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(dn,n.indices))}function ht(e,t){const n=Ir(e,t),r=_r(e,t),s={program:t,uniformSetters:n,attribSetters:r};return Z(e)&&(s.uniformBlockSpec=zr(e,t),s.transformFeedbackInfo=Fr(e,t)),s}const Ur=/\s|{|}|;/;function Dr(e,t,n,r,s){const i=rt(n,r,s),a=[];if(t=t.map(function(u){if(!Ur.test(u)){const f=Rt(u);if(f)u=f.text;else{const h=`no element with id: ${u}`;i.errorCallback(h),a.push(h)}}return u}),a.length)return mr(i,"");const o=i.callback;o&&(i.callback=(u,f)=>{o(u,u?void 0:ht(e,f))});const c=wr(e,t,i);return c?ht(e,c):null}const Nr=4,lt=5123;function Pr(e,t,n,r,s,i){n=n===void 0?Nr:n;const a=t.indices,o=t.elementType,c=r===void 0?t.numElements:r;s=s===void 0?0:s,o||a?i!==void 0?e.drawElementsInstanced(n,c,o===void 0?lt:t.elementType,s,i):e.drawElements(n,c,o===void 0?lt:t.elementType,s):i!==void 0?e.drawArraysInstanced(n,s,c,i):e.drawArrays(n,s,c)}class Mr extends EventTarget{gl;canvas;world;fieldUniforms=[];bufferInfo;programInfo=null;programVersion=0;nextProgramVersion=1;state=0;frameHandle=null;lastFrameTime=0;constructor(t,n){super();const r=t.getContext("webgl2");if(r===null)throw Error("No WEBGL 2.0 support");this.gl=r,this.canvas=t,this.world=n;const s={position:[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]};this.bufferInfo=Je(r,s)}start(){this.state!==1&&(this.updateWorld(),this.state=1,this.requestFrame())}stop(){this.frameHandle!==null&&(cancelAnimationFrame(this.frameHandle),this.state=0,this.frameHandle=null)}requestFrame(){this.frameHandle=requestAnimationFrame(this.frame.bind(this))}updateWorld(){this.setProgram(...this.world.field.getProgram())}frame(t){this.frameHandle=null;const n=t-this.lastFrameTime;if(this.lastFrameTime=t,this.dispatchEvent(new oe(t,n)),!this.programInfo){this.state=2;return}const r=this.gl,s=this.canvas,i=this.world,a=i.camera;r.viewport(0,0,s.width,s.height);const o={time:t*.001,resolution:[s.width,s.height],viewport:a.getViewport(s.width,s.height),nearRadius:a.nearRadius,farRadius:a.farRadius,cameraPosition:a.position.array,cameraRotation:a.rotation.array};for(const c of this.fieldUniforms)o[c.identifier]=c.getShaderValue();r.useProgram(this.programInfo.program),Br(r,this.programInfo,this.bufferInfo),ie(this.programInfo,o),Pr(r,this.bufferInfo),this.requestFrame()}setProgram(t,n,r){Dr(this.gl,[t,n],{callback:this.onProgramCompiled.bind(this,this.nextProgramVersion,r),errorCallback:this.onProgramError.bind(this,n)}),this.nextProgramVersion++}onProgramCompiled(t,n,r,s){if(s){if(s instanceof WebGLProgram)throw Error("Unexpected program compilation result: WebGLProgram not twgl.ProgramInfo")}else throw Error("Unexpected program compilation result: undefined result");t<=this.programVersion||(this.programInfo=s,this.programVersion=t,this.fieldUniforms=n,this.state===2&&this.start())}onProgramError(t,n,r){throw this.stop(),console.warn(t),Error(`Program compilation failed at:
`+n)}}class oe extends Event{time;delta;constructor(t,n){super("frame"),this.time=t,this.delta=n}}class Lr{position=d.zero();roll=0;pitch=0;nearRadius;farRadius;fov;constructor(t=70,n=.1,r=500){this.fov=t,this.nearRadius=n,this.farRadius=r}get rotation(){return x.rotateY(this.roll).mult(x.rotateX(this.pitch))}getViewport(t,n){const r=this.fov/360*Math.PI,s=Math.tan(r)*this.nearRadius*2,i=s/t*n;return[s,i]}look(t,n){this.roll+=t;const r=Math.PI*.5;this.pitch=Math.max(-r,Math.min(r,this.pitch+n))}move(t){this.position.add(t.clone.matrixMult(this.rotation))}}class kr{camera=new Lr;field=new ye}const Or=1e3;class Vr{canvas;world;renderer;hooks;keysHeld=new Set;state;fpsStartTime=0;fpsFrameCount=0;minDelta=1/0;maxDelta=0;constructor(t){const n=document.getElementById("canvas");if(!(n instanceof HTMLCanvasElement))throw Error("Canvas not found");this.canvas=n,this.world=new kr,this.renderer=new Mr(n,this.world),this.hooks=t,n.addEventListener("click",this.onClick.bind(this)),n.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.renderer.addEventListener("frame",this.onFrame.bind(this))}start(){this.state=this.hooks.start(this.world),this.renderer.start()}isKeyDown(t){return this.keysHeld.has(t)}async onClick(){await this.canvas.requestPointerLock({unadjustedMovement:!0})}onMouseMove(t){document.pointerLockElement===this.canvas&&this.world.camera.look(t.movementX*-.001,t.movementY*-.001)}onKeyDown(t){this.keysHeld.add(t.code)}onKeyUp(t){this.keysHeld.delete(t.code)}onFrame(t){if(t instanceof oe){if(this.fpsFrameCount++,this.minDelta=Math.min(this.minDelta,t.delta),this.maxDelta=Math.max(this.maxDelta,t.delta),t.time>this.fpsStartTime+Or){if(this.fpsStartTime>0){const r=[1e3/this.minDelta,this.fpsFrameCount/(t.time-this.fpsStartTime)*1e3,1e3/this.maxDelta].map(s=>String(Math.round(s*10)/10).padEnd(5," "));console.clear(),console.info(`FPS: High ${r[0]} Average ${r[1]} Low ${r[2]}`)}this.fpsFrameCount=0,this.fpsStartTime=t.time,this.minDelta=1/0,this.maxDelta=0}{const n=new d(0);this.isKeyDown("KeyW")&&n.z--,this.isKeyDown("KeyS")&&n.z++,this.isKeyDown("KeyA")&&n.x--,this.isKeyDown("KeyD")&&n.x++,this.isKeyDown("ShiftLeft")&&n.y--,this.isKeyDown("Space")&&n.y++,this.world.camera.move(n.norm(t.delta*.01))}this.hooks.frame&&this.hooks.frame(this,t.time,t.delta)}}}const Gr=new Vr({start:e=>{e.camera.fov=80,e.camera.roll=-1.3,e.camera.pitch=-.3,e.camera.position=new d(-7.5,6.5,4);const t=new I(new d(.7,.7,.65),new d(.15)),n=new I(new d(.1,.1,.2),new d(.6,.7,.7));return e.field=new Ae(new d(5),new me(new v(new d(-.75,.75,-.1),new st(new d(.05,.05,.2),n)),new L(.1,new v(new d(0,0,-.4),new ot(.1,new st(new d(.6,1,.3),t))),new L(.3,new v(new d(0,0,.4),new it(.7,.2,t)),new L(.4,new v(new d(0,-.3,.4),new it(.5,.2,t)),new v(new d(0,-.55,.3),new ot(.1,new pe(.4,.35,t)))))))),{}}});Gr.start();
